#!/usr/bin/env bash
set -eu -o pipefail

usage() {
    cat <<EOF
Usage: ${0##*/} [on|off|auto]

Switch current window of OSX Terminal app to "Solarized Dark" or
"Solarized Light" profile.

See https://github.com/tomislav/osx-terminal.app-colors-solarized
for the instructions on how to install those profiles.
EOF
}

DARK='Solarized Dark'
LIGHT='Solarized Light'

case "${1:-auto}" in
    help|-h|--help) usage; exit;;
    [Dd]ark|off|0|no) PROFILE="$DARK";;
    [Ll]ight|on|1|yes) PROFILE="$LIGHT";;
    auto)
        HOUR=$(date +%-H)
        if (($HOUR >= 16 || $HOUR < 5)); then
            PROFILE="$DARK"
        else
            PROFILE="$LIGHT"
        fi;;
    *) usage >&2; exit 1;;
esac

osascript -e "
tell application \"Terminal\"
    set default settings to settings set \"${PROFILE}\"
    repeat with W in windows
        set current settings of W to settings set \"${PROFILE}\"
    end repeat
end tell" 2>/dev/null
# Hiding the error which I don't know how to deal with.
# 117:192: execution error: Terminal got an error: AppleEvent handler failed. (-10000)
